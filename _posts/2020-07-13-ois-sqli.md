---
layout: post
title: BigProf-Software Online Invoicing System SQL Injection 
tags: [CVE-Writeup, SQLi]
author: Ingredous Labs
comment: true
---

```
Software Name: Online Invoicing System
Software Version: 2.8
Software Developer: https://bigprof.com/
Link to Software: https://github.com/bigprof-software/online-invoicing-system
Vulnerability: SQL Injection
CVE ID: Pending
Pending
```

# Introduction

Online Invoicing System suffers from a SQL Injection found in `/membership_passwordReset.php` which is the endpoint that is responsible for self password resets. An unauthenticated attacker is able to input a specially crafted payload which can result in sensitive information being extracted from the database eventually leading into an application takeover. This vulnerability is introduced as a result of the developer trying to roll their own sanitization implementation in order to allow the application to be used in legacy environments.

# Exploitation Details

**PHP Version used throughout this writeup: PHP 7.4.8**

Exploring the sink found in: `app/membership_passwordReset.php`:

![Screenshot]({{ site.baseurl }}/images/posts/2020/ois-sql/1.png)

On Line 5, `$username` is initialized with the value returned from passing the user-input into the `makeSafe()` function. The user-input is passed in through the `username` parameter found in the body of the following POST request:

~~~
POST /membership_passwordReset.php HTTP/1.1
Host: localhost
Content-Length: 38
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://localhost
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: http://localhost/membership_passwordReset.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: online_inovicing_system=5oknklsfinhab277rupidv112o
Connection: close

username=test&email=&reset=Ok
~~~

After `$username` is intialized, the application eventually constructs and executes a SQL query which contains the user-input as shown on Line 21:

~~~php
$where = '';
		if($username){
			$where = "lcase(memberID)='{$username}'";
		}elseif($email){
			$where = "email='{$email}'";
		}
$res = sql("select * from membership_users where {$where} limit 1", $eo);
~~~

However as `$username` is first passed into the `makeSafe()` function before being concantenated into the query, it appears to be sanitized.

Let's explore the `makeSafe()` function found in `app/admin/incFunctions.php` to learn more:

![Screenshot]({{ site.baseurl }}/images/posts/2020/ois-sql/2.png)






# Proof of Concept

